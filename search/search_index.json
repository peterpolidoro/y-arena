{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Janelia Turner Lab Y-Arena Odor Rig","title":"Home"},{"location":"#janelia-turner-lab-y-arena-odor-rig","text":"","title":"Janelia Turner Lab Y-Arena Odor Rig"},{"location":"firmware/y_arena_odor_controller/","text":"Repository https://github.com/janelia-arduino/YArenaOdorController","title":"YArenaOdorController"},{"location":"firmware/y_arena_odor_controller/#repository","text":"https://github.com/janelia-arduino/YArenaOdorController","title":"Repository"},{"location":"hardware/y_arena_odor_controller/","text":"Documentation https://janelia-kicad.github.io/y_arena_odor_controller/ Repository https://github.com/janelia-kicad/y_arena_odor_controller","title":"y_arena_odor_controller"},{"location":"hardware/y_arena_odor_controller/#documentation","text":"https://janelia-kicad.github.io/y_arena_odor_controller/","title":"Documentation"},{"location":"hardware/y_arena_odor_controller/#repository","text":"https://github.com/janelia-kicad/y_arena_odor_controller","title":"Repository"},{"location":"sa/arena/","text":"Arena Description Each arena contains three arms. The three arms are arranged so the arena looks like the letter \"Y\". A fly is placed in the arena and can walk up and down each of the three arms. Each arm has three odors, allowing the user to select one of three odors for each arm at a time. So there are a total of nine odors for each arena. Three and only three odors are active at any given time, one active odor for each arena arm. Images","title":"Arena"},{"location":"sa/arena/#arena","text":"","title":"Arena"},{"location":"sa/arena/#description","text":"Each arena contains three arms. The three arms are arranged so the arena looks like the letter \"Y\". A fly is placed in the arena and can walk up and down each of the three arms. Each arm has three odors, allowing the user to select one of three odors for each arm at a time. So there are a total of nine odors for each arena. Three and only three odors are active at any given time, one active odor for each arena arm.","title":"Description"},{"location":"sa/arena/#images","text":"","title":"Images"},{"location":"sa/module/","text":"Module Description A module contains four arenas. Layout 1 3 0 2 Images","title":"Module"},{"location":"sa/module/#module","text":"","title":"Module"},{"location":"sa/module/#description","text":"A module contains four arenas.","title":"Description"},{"location":"sa/module/#layout","text":"1 3 0 2","title":"Layout"},{"location":"sa/module/#images","text":"","title":"Images"},{"location":"sa/rig/","text":"Rig Description A rig contains four modules for a total of sixteen arenas. Layout 5 7 13 15 4 6 12 14 1 3 9 11 0 2 8 10","title":"Rig"},{"location":"sa/rig/#rig","text":"","title":"Rig"},{"location":"sa/rig/#description","text":"A rig contains four modules for a total of sixteen arenas.","title":"Description"},{"location":"sa/rig/#layout","text":"5 7 13 15 4 6 12 14 1 3 9 11 0 2 8 10","title":"Layout"},{"location":"setup/linux_host/","text":"Linux Install Docker https://github.com/janelia-experimental-technology/docker_setup Clone Repository and Build Docker Image cd y_arena_odor_controller_ros docker stop $( docker ps -aq ) docker system prune -f docker build -t y_arena_odor_controller:latest . Send Messages to ycontroller docker run --rm --net = host --pid = host -it y_arena_odor_controller:latest ros2 topic pub --once /arena_odors y_arena_interfaces/msg/ArenaOdors \"{arena: 0, odors: [0, 1, 2]}\" ros2 service call /get_arenas_available y_arena_interfaces/srv/GetArenas ros2 run y_arena_odor_controller tester & ros2 topic echo /arena_odors","title":"Linux Host"},{"location":"setup/linux_host/#linux","text":"","title":"Linux"},{"location":"setup/linux_host/#install-docker","text":"https://github.com/janelia-experimental-technology/docker_setup","title":"Install Docker"},{"location":"setup/linux_host/#clone-repository-and-build-docker-image","text":"cd y_arena_odor_controller_ros docker stop $( docker ps -aq ) docker system prune -f docker build -t y_arena_odor_controller:latest .","title":"Clone Repository and Build Docker Image"},{"location":"setup/linux_host/#send-messages-to-ycontroller","text":"docker run --rm --net = host --pid = host -it y_arena_odor_controller:latest ros2 topic pub --once /arena_odors y_arena_interfaces/msg/ArenaOdors \"{arena: 0, odors: [0, 1, 2]}\" ros2 service call /get_arenas_available y_arena_interfaces/srv/GetArenas ros2 run y_arena_odor_controller tester & ros2 topic echo /arena_odors","title":"Send Messages to ycontroller"},{"location":"setup/windows_host/","text":"Windows 10 Check for new Windows updates and install all. Matlab 2020b Download and install Matlab R2020b with ROS Toolbox. https://www.mathworks.com/downloads/ Install Chocolatey https://chocolatey.org/ Install Dependencies Open an administrative shell. choco -v choco install -y python --version 3 .7.9 --force python --version choco install -y cmake --installargs 'ADD_CMAKE_TO_PATH=System' cmake --version choco install -y visualstudio2017community choco install -y git Setup Visual Studio Restart computer. Launch the Visual Studio Installer application from the Start Menu. Click Modify Visual Studio. Select 'Desktop development with C++' Install option with default selections. Install Custom ROS Messages In file explorer, right-click any folder and select 'Git Bash Here'. cd /c/ mkdir ros cd ros git clone https://github.com/janelia-ros/y_arena_odor_controller_ros.git mkdir custom_msgs Generate Custom ROS2 Messages in Matlab In Matlab: % check to make sure python 3.7 is used pyenv mex - setup cpp % follow instructions if necessary to use the Microsoft Visual C++ 2017 compiler ros2 node list ros2 msg list folderPath = 'C:\\ros\\custom_msgs' copyfile ( 'C:\\ros\\y_arena_odor_controller_ros\\y_arena_interfaces*' , folderPath ) ros2genmsg ( folderPath , 'BuildConfiguration' , 'fasterruns' ) ros2 msg list","title":"Windows Matlab Host"},{"location":"setup/windows_host/#windows-10","text":"Check for new Windows updates and install all.","title":"Windows 10"},{"location":"setup/windows_host/#matlab-2020b","text":"Download and install Matlab R2020b with ROS Toolbox. https://www.mathworks.com/downloads/","title":"Matlab 2020b"},{"location":"setup/windows_host/#install-chocolatey","text":"https://chocolatey.org/","title":"Install Chocolatey"},{"location":"setup/windows_host/#install-dependencies","text":"Open an administrative shell. choco -v choco install -y python --version 3 .7.9 --force python --version choco install -y cmake --installargs 'ADD_CMAKE_TO_PATH=System' cmake --version choco install -y visualstudio2017community choco install -y git","title":"Install Dependencies"},{"location":"setup/windows_host/#setup-visual-studio","text":"Restart computer. Launch the Visual Studio Installer application from the Start Menu. Click Modify Visual Studio. Select 'Desktop development with C++' Install option with default selections.","title":"Setup Visual Studio"},{"location":"setup/windows_host/#install-custom-ros-messages","text":"In file explorer, right-click any folder and select 'Git Bash Here'. cd /c/ mkdir ros cd ros git clone https://github.com/janelia-ros/y_arena_odor_controller_ros.git mkdir custom_msgs","title":"Install Custom ROS Messages"},{"location":"setup/windows_host/#generate-custom-ros2-messages-in-matlab","text":"In Matlab: % check to make sure python 3.7 is used pyenv mex - setup cpp % follow instructions if necessary to use the Microsoft Visual C++ 2017 compiler ros2 node list ros2 msg list folderPath = 'C:\\ros\\custom_msgs' copyfile ( 'C:\\ros\\y_arena_odor_controller_ros\\y_arena_interfaces*' , folderPath ) ros2genmsg ( folderPath , 'BuildConfiguration' , 'fasterruns' ) ros2 msg list","title":"Generate Custom ROS2 Messages in Matlab"},{"location":"setup/ycontroller/","text":"ycontroller Setup Raspberry Pi https://github.com/janelia-experimental-technology/raspberrypi_setup username : yuser hostname : ycontroller Connect to ycontroller from host machine using SSH or web console. Clone the y-arena repository git clone https://github.com/janelia-experimental-technology/y-arena.git cd y-arena git submodule init git submodule update --recursive Install dependencies sudo apt install python3-filelock -y Build Software Containers cd ~/y-arena git pull origin master git submodule update --recursive cd software/y_arena_odor_controller_ros docker stop $( docker ps -aq ) docker system prune -f docker build -t y_arena_odor_controller:latest . Run Setup Script cd ~/y-arena/setup/ ./ycontroller_setup install sudo reboot Check systemd service systemctl status arena-attached@00.service systemd-analyze plot > boot_analysis.svg Updating sudo apt update sudo apt full-upgrade cd ~/y-arena/setup/ ./ycontroller_setup uninstall git pull origin master git submodule update --recursive ./ycontroller_setup install sudo reboot","title":"ycontroller"},{"location":"setup/ycontroller/#ycontroller","text":"","title":"ycontroller"},{"location":"setup/ycontroller/#setup-raspberry-pi","text":"https://github.com/janelia-experimental-technology/raspberrypi_setup username : yuser hostname : ycontroller Connect to ycontroller from host machine using SSH or web console.","title":"Setup Raspberry Pi"},{"location":"setup/ycontroller/#clone-the-y-arena-repository","text":"git clone https://github.com/janelia-experimental-technology/y-arena.git cd y-arena git submodule init git submodule update --recursive","title":"Clone the y-arena repository"},{"location":"setup/ycontroller/#install-dependencies","text":"sudo apt install python3-filelock -y","title":"Install dependencies"},{"location":"setup/ycontroller/#build-software-containers","text":"cd ~/y-arena git pull origin master git submodule update --recursive cd software/y_arena_odor_controller_ros docker stop $( docker ps -aq ) docker system prune -f docker build -t y_arena_odor_controller:latest .","title":"Build Software Containers"},{"location":"setup/ycontroller/#run-setup-script","text":"cd ~/y-arena/setup/ ./ycontroller_setup install sudo reboot","title":"Run Setup Script"},{"location":"setup/ycontroller/#check-systemd-service","text":"systemctl status arena-attached@00.service systemd-analyze plot > boot_analysis.svg","title":"Check systemd service"},{"location":"setup/ycontroller/#updating","text":"sudo apt update sudo apt full-upgrade cd ~/y-arena/setup/ ./ycontroller_setup uninstall git pull origin master git submodule update --recursive ./ycontroller_setup install sudo reboot","title":"Updating"},{"location":"software/y_arena_odor_controller_ros/","text":"Repository https://github.com/janelia-ros/y_arena_odor_controller_ros","title":"y_arena_odor_controller_ros"},{"location":"software/y_arena_odor_controller_ros/#repository","text":"https://github.com/janelia-ros/y_arena_odor_controller_ros","title":"Repository"},{"location":"usage/arena_odors_message/","text":"Arena Odors Message uint8 arena uint8[3] odors [0, 0, 0]","title":"Arena Odors Message"},{"location":"usage/arena_odors_message/#arena-odors-message","text":"uint8 arena uint8[3] odors [0, 0, 0]","title":"Arena Odors Message"},{"location":"usage/cli/","text":"Docker Command Line docker build -t y_arena_odor_controller:latest ./software/y_arena_odor_controller_ros/ docker run --rm --net = host --pid = host -it y_arena_odor_controller:latest ros2 service call /get_arenas_available y_arena_interfaces/srv/GetArenas ros2 topic pub --once /arena_odors y_arena_interfaces/msg/ArenaOdors \"{arena: 0, odors: [0, 2, 1]}\" ros2 run y_arena_odor_controller tester & ros2 topic echo /arena_odors","title":"Docker Command Line"},{"location":"usage/cli/#docker-command-line","text":"docker build -t y_arena_odor_controller:latest ./software/y_arena_odor_controller_ros/ docker run --rm --net = host --pid = host -it y_arena_odor_controller:latest ros2 service call /get_arenas_available y_arena_interfaces/srv/GetArenas ros2 topic pub --once /arena_odors y_arena_interfaces/msg/ArenaOdors \"{arena: 0, odors: [0, 2, 1]}\" ros2 run y_arena_odor_controller tester & ros2 topic echo /arena_odors","title":"Docker Command Line"},{"location":"usage/cpp/","text":"C++ #include <chrono> #include <functional> #include <memory> #include \"rclcpp/rclcpp.hpp\" #include \"y_arena_interfaces/msg/arena_odors.hpp\" using namespace std :: chrono_literals ; class ArenaOdorsPublisher : public rclcpp :: Node { public : ArenaOdorsPublisher () : Node ( \"arena_odors_publisher\" ), arena_ ( 0 ) { publisher_ = this -> create_publisher < y_arena_interfaces :: msg :: ArenaOdors > ( \"/arena_odors\" , 10 ); timer_ = this -> create_wall_timer ( 500 ms , std :: bind ( & ArenaOdorsPublisher :: timer_callback , this )); } private : void timer_callback () { auto message = y_arena_interfaces :: msg :: ArenaOdors (); message . arena = arena_ ; message . odors = { 0 , 2 , 1 }; publisher_ -> publish ( message ); arena_ = ( arena_ + 1 ) % ARENA_COUNT ; } rclcpp :: TimerBase :: SharedPtr timer_ ; rclcpp :: Publisher < y_arena_interfaces :: msg :: ArenaOdors >:: SharedPtr publisher_ ; size_t arena_ ; static const size_t ARENA_COUNT = 16 ; }; int main ( int argc , char * argv []) { rclcpp :: init ( argc , argv ); rclcpp :: spin ( std :: make_shared < ArenaOdorsPublisher > ()); rclcpp :: shutdown (); return 0 ; }","title":"C++"},{"location":"usage/cpp/#c","text":"#include <chrono> #include <functional> #include <memory> #include \"rclcpp/rclcpp.hpp\" #include \"y_arena_interfaces/msg/arena_odors.hpp\" using namespace std :: chrono_literals ; class ArenaOdorsPublisher : public rclcpp :: Node { public : ArenaOdorsPublisher () : Node ( \"arena_odors_publisher\" ), arena_ ( 0 ) { publisher_ = this -> create_publisher < y_arena_interfaces :: msg :: ArenaOdors > ( \"/arena_odors\" , 10 ); timer_ = this -> create_wall_timer ( 500 ms , std :: bind ( & ArenaOdorsPublisher :: timer_callback , this )); } private : void timer_callback () { auto message = y_arena_interfaces :: msg :: ArenaOdors (); message . arena = arena_ ; message . odors = { 0 , 2 , 1 }; publisher_ -> publish ( message ); arena_ = ( arena_ + 1 ) % ARENA_COUNT ; } rclcpp :: TimerBase :: SharedPtr timer_ ; rclcpp :: Publisher < y_arena_interfaces :: msg :: ArenaOdors >:: SharedPtr publisher_ ; size_t arena_ ; static const size_t ARENA_COUNT = 16 ; }; int main ( int argc , char * argv []) { rclcpp :: init ( argc , argv ); rclcpp :: spin ( std :: make_shared < ArenaOdorsPublisher > ()); rclcpp :: shutdown (); return 0 ; }","title":"C++"},{"location":"usage/matlab/","text":"Matlab yArenaNode = ros2node ( 'y_arena_matlab_node' ) arenaOdorsPub = ros2publisher ( yArenaNode , '/arena_odors' , 'y_arena_interfaces/ArenaOdors' ) arenaOdorsMsg = ros2message ( 'y_arena_interfaces/ArenaOdors' ) arenaOdorsMsg . arena = uint8 ( 0 ) arenaOdorsMsg . odors = uint8 ([ 0 2 1 ]) send ( arenaOdorsPub , arenaOdorsMsg )","title":"Matlab"},{"location":"usage/matlab/#matlab","text":"yArenaNode = ros2node ( 'y_arena_matlab_node' ) arenaOdorsPub = ros2publisher ( yArenaNode , '/arena_odors' , 'y_arena_interfaces/ArenaOdors' ) arenaOdorsMsg = ros2message ( 'y_arena_interfaces/ArenaOdors' ) arenaOdorsMsg . arena = uint8 ( 0 ) arenaOdorsMsg . odors = uint8 ([ 0 2 1 ]) send ( arenaOdorsPub , arenaOdorsMsg )","title":"Matlab"},{"location":"usage/odors_vector/","text":"Odors Vector arena_odors_message.odors = [arm 0 odor, arm 1 odor, arm 2 odor] The three active odors can be represented by a vector, where each element of the vector represents one of the arms, ARM 0, ARM 1, and ARM 2. Each vector element can take one of three values, 0, 1, or 2, representing ODOR 0, ODOR 1, or ODOR 2. odors = [0, 2, 1] ODOR 0 ODOR 1 ODOR 2 ARM 2 INACTIVE ACTIVE INACTIVE ARM 1 INACTIVE INACTIVE ACTIVE ARM 0 ACTIVE INACTIVE INACTIVE odors = [0, 0, 0] ODOR 0 ODOR 1 ODOR 2 ARM 2 ACTIVE INACTIVE INACTIVE ARM 1 ACTIVE INACTIVE INACTIVE ARM 0 ACTIVE INACTIVE INACTIVE","title":"Odors Vector"},{"location":"usage/odors_vector/#odors-vector","text":"arena_odors_message.odors = [arm 0 odor, arm 1 odor, arm 2 odor] The three active odors can be represented by a vector, where each element of the vector represents one of the arms, ARM 0, ARM 1, and ARM 2. Each vector element can take one of three values, 0, 1, or 2, representing ODOR 0, ODOR 1, or ODOR 2.","title":"Odors Vector"},{"location":"usage/odors_vector/#odors-0-2-1","text":"ODOR 0 ODOR 1 ODOR 2 ARM 2 INACTIVE ACTIVE INACTIVE ARM 1 INACTIVE INACTIVE ACTIVE ARM 0 ACTIVE INACTIVE INACTIVE","title":"odors = [0, 2, 1]"},{"location":"usage/odors_vector/#odors-0-0-0","text":"ODOR 0 ODOR 1 ODOR 2 ARM 2 ACTIVE INACTIVE INACTIVE ARM 1 ACTIVE INACTIVE INACTIVE ARM 0 ACTIVE INACTIVE INACTIVE","title":"odors = [0, 0, 0]"},{"location":"usage/python/","text":"Python import rclpy from rclpy.node import Node from y_arena_interfaces.msg import ArenaOdors class ArenaOdorsPublisher ( Node ): ARENA_COUNT = 16 def __init__ ( self ): super () . __init__ ( 'arena_odors_publisher' ) self . publisher_ = self . create_publisher ( ArenaOdors , '/arena_odors' , 10 ) timer_period = 0.5 # seconds self . timer = self . create_timer ( timer_period , self . timer_callback ) self . _arena = 0 def timer_callback ( self ): msg = ArenaOdors () msg . arena = self . _arena msg . odors = [ 0 , 2 , 1 ] self . publisher_ . publish ( msg ) self . _arena = ( self . _arena + 1 ) % self . ARENA_COUNT def main ( args = None ): rclpy . init ( args = args ) arena_odors_publisher = ArenaOdorsPublisher () rclpy . spin ( arena_odors_publisher ) # Destroy the node explicitly # (optional - otherwise it will be done automatically # when the garbage collector destroys the node object) arena_odors_publisher . destroy_node () rclpy . shutdown () if __name__ == '__main__' : main ()","title":"Python"},{"location":"usage/python/#python","text":"import rclpy from rclpy.node import Node from y_arena_interfaces.msg import ArenaOdors class ArenaOdorsPublisher ( Node ): ARENA_COUNT = 16 def __init__ ( self ): super () . __init__ ( 'arena_odors_publisher' ) self . publisher_ = self . create_publisher ( ArenaOdors , '/arena_odors' , 10 ) timer_period = 0.5 # seconds self . timer = self . create_timer ( timer_period , self . timer_callback ) self . _arena = 0 def timer_callback ( self ): msg = ArenaOdors () msg . arena = self . _arena msg . odors = [ 0 , 2 , 1 ] self . publisher_ . publish ( msg ) self . _arena = ( self . _arena + 1 ) % self . ARENA_COUNT def main ( args = None ): rclpy . init ( args = args ) arena_odors_publisher = ArenaOdorsPublisher () rclpy . spin ( arena_odors_publisher ) # Destroy the node explicitly # (optional - otherwise it will be done automatically # when the garbage collector destroys the node object) arena_odors_publisher . destroy_node () rclpy . shutdown () if __name__ == '__main__' : main ()","title":"Python"},{"location":"usage/ssh/","text":"SSH ssh yuser@ycontroller # local network ssh yuser@ycontroller.local # inside Janelia ssh yuser@ycontroller.hhmi.org","title":"SSH"},{"location":"usage/ssh/#ssh","text":"ssh yuser@ycontroller # local network ssh yuser@ycontroller.local # inside Janelia ssh yuser@ycontroller.hhmi.org","title":"SSH"},{"location":"usage/web_console/","text":"Web Console https://ycontroller:9090 Local Network https://ycontroller.local:9090 Inside Janelia https://ycontroller.hhmi.org:9090","title":"Web Console"},{"location":"usage/web_console/#web-console","text":"https://ycontroller:9090","title":"Web Console"},{"location":"usage/web_console/#local-network","text":"https://ycontroller.local:9090","title":"Local Network"},{"location":"usage/web_console/#inside-janelia","text":"https://ycontroller.hhmi.org:9090","title":"Inside Janelia"}]}